WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.drag-and-drop:default-drop-handler', location = 'js/default-drop-handler.js' */
define("confluence-drag-and-drop/default-drop-handler","ajs document confluence/meta jquery confluence/legacy underscore plupload window confluence/api/constants confluence/api/event confluence/message-controller".split(" "),function(c,m,i,n,j,s,k,t,u,o,v){var l={},p=false;l.initialise=function(){function l(){b=c.Editor&&c.Editor.isVisible()&&j.EditorUploadProgressDialog?j.EditorUploadProgressDialog:new c.DragAndDropProgressDialog}function q(){var b=n(".aui-blanket:visible");return b.length&&b.css("visibility")!==
"hidden"&&!n("#drag-and-drop-progress-dialog:visible").length}function r(){for(;f.files.length;)f.removeFile(f.files[0])}var b,h,f;if(!p){p=true;c.DragAndDrop.defaultDropHandler=null;h=m.getElementById("fileuploadShim");if(!h){h=m.createElement("div");h.setAttribute("id","fileuploadShim");m.body.appendChild(h)}f=new k.Uploader({runtimes:"html5",dragdrop:true,drop_element:m.body,browse_button:h.getAttribute("id"),multipart:false,stop_propagation:true,max_file_size:+i.get("global-settings-attachment-max-size")});
b=null;f.init();f.bind("FilesAdded",function(g,a){var d=c.Editor;if(q())r();else if(d&&d.isVisible()){d=d.getCurrentForm().parentElement.classList;j.Uploader&&(d.contains("ic-body")||d.contains("comment-body"))&&j.Uploader.trigger("FilesAdded",s.reject(a,function(a){return a.status===k.FAILED}))}else c.UploadUtils.filterFiles(g,a,function(a,c){var d,g;b||l();for(d=0;d<c.length;d++){g=c[d];g.status!==k.FAILED&&b.render({workId:g.id,status:g.status,file:g})}f.start()})});f.bind("BeforeUpload",function(g,
a){if(!c.Editor||!c.Editor.isVisible()){var d=c.DragAndDropUtils.base+u.CONTEXT_PATH+"/plugins/drag-and-drop/upload.action",e=i.get("page-id"),e=e!=0?{pageId:e}:{draftId:i.get("draft-id")},f=a.name.substr(a.name.lastIndexOf(".")+1);e.filename=a.name;e.size=a.size;e.mimeType=k.mimeTypes[f.toLowerCase()]||c.DragAndDropUtils.defaultMimeType;e.spaceKey=i.get("space-key");e.atl_token=i.get("atl-token");g.settings.url=k.buildUrl(d,e);b.cancelListeners.push(function(a,d){var e=g.getFile(d.workId);e&&g.removeFile(e);
b.renderInfo(d.workId,"File was manually removed from the queue.")});b.show()}});f.bind("UploadProgress",function(c,a){b.renderUpdateToBytesUploaded(a.id,a.loaded,a.size);b.hideCloseButton()});f.bind("FileUploaded",function(f,a,d){d.status===0?b.renderError(a.id,"The server is not responding. Please check that it is running."):b.renderComplete(a.id)});f.bind("Error",function(f,a){var d,e;if(q())r();else if(c.Editor&&c.Editor.isVisible())j.Uploader&&j.Uploader.trigger("Error",a);else if(a.response){try{d=
n.parseJSON(a.response);e=d.actionErrors[0]}catch(h){if(h.name==="SyntaxError")e="Invalid response received from the server.";else{a.responseText=a.response;e=v.parseError(a)}}b.renderError(a.file.id,e);o.trigger("analyticsEvent",{name:"confluence.default-drop.upload.error.server-unknown"})}else{e=a.message;if(a.code===k.FILE_SIZE_ERROR){e=c.format("is too big to upload. Files must be less than {0}.",c.DragAndDropUtils.niceSize(i.get("global-settings-attachment-max-size")));o.trigger("analyticsEvent",
{name:"confluence.default-drop.upload.error.file-size"})}else if(a.code===c.UploadUtils.ErrorCode.FILE_IS_A_FOLDER_ERROR){e="might be a folder or an unsupported file type.";o.trigger("analyticsEvent",{name:"confluence.default-drop.upload.error.file-type"})}b||l();b.render({workId:a.file.id,status:a.file.status,file:a.file,errorMessage:e});if(!b.isVisible()){b.show();b.showCloseButton()}}});f.bind("UploadComplete",function(){if(!f.total.queued&&b){b.showCloseButton();b.hasErrors()||setTimeout(function(){b.hide();
b.clearRenderOutput();t.location.reload()},1E3)}})}};return l});
}catch(e){WRMCB(e)};